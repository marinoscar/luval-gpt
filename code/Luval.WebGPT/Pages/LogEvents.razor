@page "/LogEvents"

@using Luval.GPT.Logging
@using Luval.GPT.Logging.NamedPipes

<AuthorizeView Roles="Admin">
    <Authorized>
        <div class="row">
            <div class="col">
                @foreach(var e in Messages)
                {
                    <p>@e.Message</p>
                }
            </div>
        </div>
    </Authorized>
    <NotAuthorized>
        <div class="alert alert-warning" role="alert">
            <h4 class="alert-heading">No Access</h4>
            <hr>
            <p>You don't have the required permission to access this resource</p>
        </div>
    </NotAuthorized>
</AuthorizeView>

@code {
    private List<PipeLogEvent> Messages { get; set; } = new List<PipeLogEvent>();
    private PipeClient Client { get; set; } = new PipeClient();

    protected override void OnInitialized()
    {
        Client.OpenConnection();
        Client.OnMessageRecieved = Message;
        base.OnInitialized();
    }

    private void Message(PipeLogEvent e)
    {
        if (Messages.Count > 100) Messages.RemoveAt(0);
        Messages.Add(e);
        InvokeAsync(StateHasChanged);
    }

}
